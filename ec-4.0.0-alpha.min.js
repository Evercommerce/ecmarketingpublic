/**
 * Author: EverCommerce
 * Author URI: https://www.evercommerce.com/
 * Version: 4.0.0-alpha
 * Updated: 02/14/2024
 * 
 * Copyright EverCommerce
 * All Rights Reserved.
 * 
 * NOTICE: Unauthorized use or copying of this file
 *         via any medium is strictly prohibited.
 *         Proprietary and confidential
 */
(()=>{function e(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function o(e){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{};o%2?t(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,i,a,c=[],l=!0,u=!1;try{if(i=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;l=!1}else for(;!(l=(n=i.call(o)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,r=e}finally{try{if(!l&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(u)throw r}}return c}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return a(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function c(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function l(e,t,o){return(t=u(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function u(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:String(t)}var s=function(){function t(){var e=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"getFirst",(function(){return e._readCookie("__ecatft")})),l(this,"getLast",(function(){return e._readCookie("__ecatlt")})),l(this,"autofill",(function(t){var o=e._readCookie("__ecatft"),n=e._readCookie("__ecatlt");t?(e.config.debug&&(console.group("%c [$EC Debugger]","color: #16CA94","Field Mapping"),console.table(t),console.groupEnd()),setTimeout((function(){Object.keys(t.first_touch).forEach((function(e){document.querySelectorAll(t.first_touch[e]).forEach((function(t){t.value=o[e]||"[blank]"}))})),Object.keys(t.last_touch).forEach((function(e){document.querySelectorAll(t.last_touch[e]).forEach((function(t){t.value=n[e]||"[blank]"}))}))}),50)):console.error("[$EC] Error: Must provide field map to autofill form fields.")})),l(this,"log",(function(){console.group("About $EC"),console.log("Version: ",e.version),console.log("Domain: ",e.domain),console.log("Config:",e.config),console.groupEnd(),console.group("Analytics APIs"),e.apis.analytics?console.log('Segment\'s "analytics" APIs will be used for track and identify'):e.apis.heap?console.log('Heap\'s "heap" APIs will be used for track and identify'):e.config.debug&&console.warn("No analytics tracking API defined."),console.groupEnd(),console.group("Forms APIs"),void 0!==window.MktoForms2?console.log("MktoForms2 is available"):void 0!==window.HubSpotForms?console.log("HubsSpotForms is available"):e.config.debug&&console.warn("No forms API defined."),console.groupEnd();var t=e._readCookie("__ecatft"),o=e._readCookie("__ecatlt");console.group("Attribution Cookie Data"),console.log("First Touch (__ecatft)",t),console.log("Last Touch  (__ecatlt)",o),console.groupEnd()})),l(this,"identify",(function(t){if(t){if(!e.apis.analytics&&!e.apis.heap)return console.error("[$EC] Error: identify API is not defined."),e.config.debug?e.generateUUID(t):void 0;if(window.analytics.identity||window.heap.identity){var o=window.analytics.identity||window.heap.identity;return e.config.debug&&console.log("%c [$EC Debugger]","color: #16CA94","Already Identified: ",o),o}var n=e.generateUUID(t);return window.analytics.identity?window.analytics.identify(n):window.heap.identity?window.heap.identify(n):console.error("[$EC] Error: Unable to identify user."),e.config.debug&&console.log("%c [$EC Debugger]","color: #16CA94","Identified: ",n),n}console.error("[$EC] Error: Must provide an email address.")})),l(this,"track",(function(t,o){e.apis.analytics?(window.analytics.track(t,o),e.config.debug&&console.log("%c [$EC Debugger]","color: #16CA94","Segment Event | Name: ".concat(t,", Props:"),o)):e.apis.heap?(window.heap.track(t,o),e.config.debug&&console.log("%c [$EC Debugger]","color: #16CA94","Heap Event | Name: ".concat(t,", Props:"),o)):e.config.debug&&console.warn("%c [$EC Debugger]","color: #16CA94","No analytics API defined.")})),l(this,"generateUUID",(function(e){var t=function(e){function t(e,t){return(t>>>e|t<<32-e)>>>0}return function(){for(var o=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),n=new Uint32Array(64),r=1779033703,i=3144134277,a=1013904242,c=2773480762,l=1359893119,u=2600822924,s=528734635,d=1541459225,m=function(e){for(var t=(448-e.length-1)%512,o=new Uint8Array(t/8+1).fill(0),n=8*e.length,r=new Uint8Array(8),i=0;i<8;i++)r[i]=n>>>56-8*i&255;for(var a=new Uint8Array(e.length+1+o.length+r.length),c=0;c<e.length;c++)a[c]=e[c];a[e.length]=128;for(var l=0;l<o.length;l++)a[e.length+1+l]=o[l];for(var u=0;u<r.length;u++)a[e.length+1+o.length+u]=r[u];return a}(e.split("").map((function(e){return e.charCodeAt(0)}))),_=function(e){if("string"!=typeof e&&(e=e.toString()),!e.length)return new Uint32Array(0);for(var t=new Uint32Array(e.length/4),o=0;o<e.length;o+=4)t[o/4]=e.charCodeAt(o)<<24|e.charCodeAt(o+1)<<16|e.charCodeAt(o+2)<<8|e.charCodeAt(o+3);return t}(m),f=0;f<_.length;f+=16){for(var g=n,p=0;p<16;p++)g[p]=_[f+p];for(var b=16;b<64;b++){var h=t(7,g[b-15])^t(18,g[b-15])^g[b-15]>>>3,y=t(17,g[b-2])^t(19,g[b-2])^g[b-2]>>>10;g[b]=g[b-16]+h+g[b-7]+y>>>0}for(var v=r,w=i,k=a,E=c,C=l,F=u,A=s,L=d,S=0;S<64;S++){var U=d+(t(6,l)^t(11,l)^t(25,l))+(l&u^~l&s)+o[S]+g[S]>>>0;L=A,A=F,F=C,C=E+U>>>0,E=k,k=w,w=v,v=U+((t(2,r)^t(13,r)^t(22,r))+(r&i^r&a^i&a)>>>0)>>>0}r=r+v>>>0,i=i+w>>>0,a=a+k>>>0,c=c+E>>>0,l=l+C>>>0,u=u+F>>>0,s=s+A>>>0,d=d+L>>>0}return[r,i,a,c,l,u,s,d].map((function(e){return e.toString(16).padStart(8,"0")})).join("")}()}(e=e.toLowerCase().trim());return t.slice(0,8)+"-"+t.slice(8,12)+"-4"+t.slice(13,16)+"-a"+t.slice(17,20)+"-"+t.slice(20)})),l(this,"loadMarketoBlindForm",(function(t){if(!t)return console.error("[$EC] Error: Blind form config object missing option(s)"),console.log("Provided Config:"),void console.log(t);var o=document.createElement("form");o.id="mktoForm_".concat(t.mktoFormId),e.config.debug||(o.style.display="none"),document.body.appendChild(o),e.config.debug&&console.warn("%c [$EC Debugger]","color: #16CA94","Marketo Form is displayed in debug mode. Disable Debug mode for production use.",o);var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src="//".concat(t.mktoDomain,"/js/forms2/js/forms2.min.js"),document.body.appendChild(i),i.addEventListener("load",(function(){e._handleMktoForms(),window.MktoForms2.loadForm("//".concat(t.mktoDomain),t.munchkinId,t.mktoFormId),window.MktoForms2.whenRendered((function(o){var i=document.querySelector(t.formSelector);o.getFormElem()[0].setAttribute("data-formType","blind"),i.setAttribute("data-formType","blind"),o.getFormElem()[0].setAttribute("data-boundForm",t.formSelector),t.followupUrl&&(o.followupUrl=t.followupUrl,e.config.debug&&console.log("%c [$EC Debugger]","color: #16CA94","Followup URL Set: ".concat(t.followupUrl))),t.bindFields?(void 0!==t.dataMap?(e.config.debug&&console.log("%c [$EC Debugger]","color: #16CA94","Binding fields...",t.dataMap),Object.entries(t.dataMap).forEach((function(e){var t=r(e,2),o=t[0],n=t[1],a=i.querySelector(o);a?a.addEventListener("change",(function(){var e=a.value,t=document.querySelector('input[name="'.concat(n,'"]'));"checkbox"===a.type?t.checked=a.checked:t.value=e})):console.error("[$EC] Error: Field with selector ".concat(o," does not exist."))}))):console.error("[$EC] Error: Missing field mapping."),t.bindSubmitEvent&&i.addEventListener("submit",(function(){o.submit()}))):t.submitData&&(null!=n(t.dataMap)?(e.config.debug&&console.log("%c [$EC Debugger]","color: #16CA94","Populating with provided data...",t.dataMap),o.vals(t.dataMap)):console.error("[$EC] Error: Missing field data."))})),t.submitOnLoad&&t.submitData&&(e.config.debug&&console.log("%c [$EC Debugger]","color: #16CA94","Submitting Marketo form..."),window.MktoForms2.whenReady((function(e){e.submit()})))}))})),l(this,"submitMarketoBlindForm",(function(e){document.querySelector("#mktoForm_".concat(e.mktoFormId)).submit()})),l(this,"enableMarketoKioskMode",(function(){console.warn("[$EC] Kiosk Mode Enabled"),document.cookie="_mkto_trk=;path=/;domain=".concat(e.domain,";expires=0"),window.MktoForms2.whenRendered((function(e){e.getFormElem()[0].setAttribute("data-formType","kiosk"),e.addHiddenFields({_mkt_trk:""})}))})),this._initialize(window.$EC.config),this.version="4.0.0-alpha",this.q=window.$EC.q,this.apis={MktoForms2:!1,HubSpotForms:!1,analytics:!1,heap:!1}}var i,a,u;return i=t,(a=[{key:"_handleMktoForms",value:function(){var e=this;window.MktoForms2.whenReady((function(t){var n=t.getFormElem()[0],r=e._readCookie("__ecatft"),i=e._readCookie("__ecatlt"),a={ec_utm_campaign_first__c:r.utm_campaign||"NULL",ec_utm_source_first__c:r.utm_source||"NULL",ec_utm_medium_first__c:r.utm_medium||"NULL",ec_utm_content_first__c:r.utm_content||"NULL",ec_utm_term_first__c:r.utm_term||"NULL",ec_utm_device_first__c:r.utm_device||"NULL",gclid__c:r.gclid||"NULL",GCLID__c:r.gclid||"NULL",ec_landing_page_first__c:r.lp||"NULL",ec_referrer_first__c:r.referrer||"NULL",ec_utm_campaign_last__c:i.utm_campaign||"NULL",ec_utm_source_last__c:i.utm_source||"NULL",ec_utm_medium_last__c:i.utm_medium||"NULL",ec_utm_content_last__c:i.utm_content||"NULL",ec_utm_term_last__c:i.utm_term||"NULL",ec_utm_device_last__c:i.utm_device||"NULL",gclid_last__c:i.gclid||"NULL",GCLID_last__c:i.gclid||"NULL",ec_referrer_last__c:i.referrer||"NULL",ec_landing_page_last__c:i.lp||"NULL"},c={"Form ID":"mktoForm_".concat(t.getId())};n.getAttribute("data-formType")&&(c["Form Type"]=n.getAttribute("data-formType")),n.getAttribute("data-boundForm")&&(c["Bound Form Selector"]=n.getAttribute("data-boundForm")),"kiosk"!==n.getAttribute("data-formType")&&t.addHiddenFields(a),t.onSubmit((function(){if("kiosk"===t.getAttribute("data-formType")&&t.vals({_mkt_trk:""}),t.validate()){var n=t.vals().Email,r=e.identify(n);t.addHiddenFields({ec_heap_id__c:r})}var i=o({Event:"Before Submit",Submittable:t.submittable()},c);e.track("Marketo Form Event",i),e.config.debug&&(console.group("%c [$EC Debugger]","color: #16CA94","Form Vals"),console.table(t.vals()),console.groupEnd())})),t.onValidate((function(t){var n=o({Event:"Validate",Valid:t},c);e.track("Marketo Form Event",n)})),t.onSuccess((function(){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"MarketoFormSubmit",formId:"mktoForm_".concat(t.getId()),pageUrl:"".concat(window.location.origin).concat(window.location.pathname)});var n=o({Event:"Submitted"},c);if(e.track("Marketo Form Event",n),"blind"===t.getAttribute("data-formType"))return t.followupUrl&&document.location.replace(t.followupUrl),!1}))}))}},{key:"_handleHubspotForms",value:function(){var e=this;this.autofill({first_touch:{utm_campaign:"input[name=ec_utm_campaign_first__c]",utm_source:"input[name=ec_utm_source_first__c]",utm_medium:"input[name=ec_utm_medium_first__c]",utm_content:"input[name=ec_utm_content_first__c]",utm_term:"input[name=ec_utm_term_first__c]",utm_device:"input[name=ec_utm_device_first__c]",lp:"input[name=ec_landing_page_first__c]",referrer:"input[name=ec_referrer_first__c]",gclid:"input[name=gclid__c]"},last_touch:{utm_campaign:"input[name=ec_utm_campaign_last__c]",utm_source:"input[name=ec_utm_source_last__c]",utm_medium:"input[name=ec_utm_medium_last__c]",utm_content:"input[name=ec_utm_content_last__c]",utm_term:"input[name=ec_utm_term_last__c]",utm_device:"input[name=ec_utm_device_last__c]",lp:"input[name=ec_landing_page_last__c]",referrer:"input[name=ec_referrer_last__c]",gclid:"input[name=ec_gclid_last__c]"}}),window.addEventListener("message",(function(t){"hsFormCallback"===t.data.type&&"onFormSubmitted"===t.data.eventName&&(window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"HubSpotFormSubmit",formId:t.data.id,pageUrl:"".concat(window.location.origin).concat(window.location.pathname)}),e.track("Marketing - HubSpot Form Event",{"Form ID":t.data.id,Event:"Submitted"}))}))}},{key:"_createCookie",value:function(e,t){if(e)if(t){var o=t?JSON.stringify(t):"",n="";if("__ecatft"==e){var r=new Date;r.setFullYear(r.getFullYear()+10),n=" expires="+r.toUTCString()+";"}document.cookie=e+"="+o+"; path=/; domain="+this.domain+";"+n}else console.error("[$EC] Error: Must provide a value.");else console.error("[$EC] Error: Must provide a name.")}},{key:"_readCookie",value:function(e){if(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var r=o[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return JSON.parse(r.substring(t.length,r.length))}return{}}console.error("[$EC] Error: Must provide a name.")}},{key:"_extractHostname",value:function(){var e,t=window.location.href;if("localhost"!==(e="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?window.location.hostname:t.indexOf("://")>-1?t.split("/")[2]:t.split("/")[0])&&"127.0.0.1"!==e){var o=(e=(e=e.split(":")[0]).split("?")[0]).split(".");e=o[o.length-2]+"."+o[o.length-1]}return e}},{key:"_handleAttributionCookie",value:function(){var e=this._readCookie("__ecatft"),t=this._readCookie("__ecatlt"),o=new URLSearchParams(document.location.search),n={utm_campaign:o.get("utm_campaign")?o.get("utm_campaign").substring(0,254):"",utm_source:o.get("utm_source")?o.get("utm_source").substring(0,254):"",utm_medium:o.get("utm_medium")?o.get("utm_medium").substring(0,254):"",utm_content:o.get("utm_content")?o.get("utm_content").substring(0,254):"",utm_term:o.get("utm_term")?o.get("utm_term").substring(0,254):"",utm_device:o.get("utm_device")?o.get("utm_device").substring(0,254):"",referrer:document.referrer.split("?")[0].substring(0,254)||"",gclid:o.get("gclid")?o.get("gclid").substring(0,254):"",lp:(document.location.hostname+document.location.pathname).substring(0,254)||""};0===Object.keys(e).length&&this._createCookie("__ecatft",n),0===Object.keys(t).length&&this._createCookie("__ecatlt",n)}},{key:"_handleQueuedEvents",value:function(){var t=this;this.q&&this.q.forEach((function(o){var n=o[0],r=o.slice(1);["getFirst","getLast","generateUUID"].includes(n)?console.error("[$EC] Error: Method ".concat(n,"(").concat(r.join(", "),") cannot be queued, called too early.")):(console.warn("[$EC] Method $EC.".concat(n,"(").concat(r,") called before $EC initialized. Calling now...")),t[n].apply(t,e(r)))}))}},{key:"_initialize",value:function(e){var t=this;this.initialized?console.warn("$EC has already been initialized."):(this.config=e||{},this.initialized=!0,this.domain=this._extractHostname(),this._handleAttributionCookie(),window.addEventListener("load",(function(){void 0!==window.MktoForms2&&(t.apis.MktoForms2=!0,t._handleMktoForms()),void 0!==window.HubSpotForms&&(t.apis.HubSpotForms=!0,t._handleHubspotForms()),t.apis.analytics=void 0!==window.analytics,t.apis.heap=void 0!==window.heap,t._handleQueuedEvents()})))}}])&&c(i.prototype,a),u&&c(i,u),Object.defineProperty(i,"prototype",{writable:!1}),t}();window.$EC=new s})();
